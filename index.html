<!DOCTYPE html>
<html>
<head>
    <title>Logseq Bridge</title>
    <style>
        body { 
            background: #111; color: #eee; font-family: sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; height: 100vh; margin: 0; 
        }
        button { 
            padding: 15px 30px; font-size: 1.2rem; cursor: pointer; 
            background: #2d81ff; color: white; border: none; border-radius: 8px; 
        }
        button:hover { background: #1a66cc; }
    </style>
<script>
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        const page = params.get('page') || 'TODAY';
        const content = params.get('content') || '';

        // 1. THE "TARGETED" HUNT:
        // We look for everything AFTER #CALLS and find the next #
        // ([^ ]+) captures everything until the next space
        const secondaryHashMatch = content.match(/#CALLS.*#([^ ]+)/i);
        let extractedValue = secondaryHashMatch ? secondaryHashMatch[1] : "";

        // 2. THE "NUMERIC" FILTER:
        // Strip the # or any trailing punctuation to get just the digits
        const cleanNumber = extractedValue.replace(/\D/g, '');

        // 3. Fire to Logseq
        const logseqURI = `logseq://x-callback-url/quickCapture?page=${encodeURIComponent(page)}&content=${encodeURIComponent(content)}`;
        window.location.href = logseqURI;

        // 4. The Pivot to 1881
        setTimeout(() => {
            if (cleanNumber) {
                window.location.href = `https://www.1881.no/?query=${cleanNumber}`;
            } else {
                window.location.href = "https://www.1881.no";
            }
        }, 800);
    };
</script>
</head>
<body>
    <h2>Sent to Logseq!</h2>
    <p>If this tab didn't "self-destruct," hit the button:</p>
    <button onclick="window.close()">Close Tab</button>
</body>
</html>
